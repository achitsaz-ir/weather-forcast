#!/usr/bin/env sh
. "$(dirname -- "$0")/_/husky.sh"

git branch --show-current | egrep "^(master|develop|(feature|bugFix|hotFix)\/T[0-9]+\-[a-z])" || \
(echo "git branch name validation failed. valid ex: [feature]/[T][20293][-](camelCase)addHuskyToProject" && exit 1)

egrep "^[🐛|✨|️🚑|🎨|🔒️|⬆️|🚧|🔥]+ \[[0-9]+\] [A-Z]" -r .git/COMMIT_EDITMSG || \
(echo "git message validation failed. valid ex: [🐛|✨|️🚑|🎨|🔒️|⬆️|🚧|🔥] [20065] (upperCase)Test message" && exit 1)

git diff > /tmp/patch

git stash --keep-index --include-untracked -m "Autogenerated by Husky"

docker exec -i meta_dev_frontend npx eslint \
  $(git diff --diff-filter=ACMRTUXB --name-only --cached -- 'frontend/' | sed "s#frontend/##g" -) \
  && docker exec -i meta_dev_frontend npx tsc \
  && git apply /tmp/patch --allow-empty || (git apply /tmp/patch --allow-empty &&  exit 1)