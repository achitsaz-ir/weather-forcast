#!/usr/bin/env sh
. "$(dirname -- "$0")/_/husky.sh"

git branch --show-current | egrep "^(main|develop|(feature|bugFix|hotFix)\/T[0-9]+\-[a-z])" || \
(echo "git branch name validation failed. valid ex: [feature]/[T][20293][-](camelCase)addHuskyToProject" && exit 1)

egrep "^[ðŸ›|âœ¨|ï¸ðŸš‘|ðŸŽ¨|ðŸ”’ï¸|â¬†ï¸|ðŸš§|ðŸ”¥]+ \[[0-9]+\] [A-Z]" -r .git/COMMIT_EDITMSG || \
(echo "git message validation failed. valid ex: [ðŸ›|âœ¨|ï¸ðŸš‘|ðŸŽ¨|ðŸ”’ï¸|â¬†ï¸|ðŸš§|ðŸ”¥] [20065] (upperCase)Test message" && exit 1)

git diff > /tmp/patch

git stash --keep-index --include-untracked -m "Autogenerated by Husky"

pnpm eslint \
  $(git diff --diff-filter=ACMRTUXB --name-only --cached -- '.' | sed "s#.##g" -) \
  && pnpm tsc \
  && git apply /tmp/patch --allow-empty || (git apply /tmp/patch --allow-empty &&  exit 1) 